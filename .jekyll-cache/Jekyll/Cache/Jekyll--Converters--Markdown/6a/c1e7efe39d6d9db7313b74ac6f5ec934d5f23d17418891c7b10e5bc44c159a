I"ï<h3 id="savepersist-mergeì™€-isnew">save(persist, merge)ì™€ isNew</h3>

<ul>
  <li>saveë¥¼ í•˜ë©´, jpaëŠ” ì €ì¥í•˜ë ¤ëŠ” entityê°€ isNew ì¸ì§€ í™•ì¸í•˜ì—¬, isNewë¼ë©´ persistë¥¼ í˜¸ì¶œí•˜ê³ , ì•„ë‹ˆë¼ë©´ mergeë¥¼ ì§„í–‰í•œë‹¤.</li>
  <li>persist : ìµœì´ˆ ìƒì„±ëœ entityë¥¼ ì˜ì†í™” í•œë‹¤.</li>
  <li>merge : ì‹ë³„ìê°’(id)ë¡œ 1ì°¨ ìºì‹œì—ì„œ ì¡°íšŒí•˜ê³ , ì—†ìœ¼ë©´ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì¡°íšŒí•˜ê³  1ì°¨ ìºì‹œì— ì €ì¥í•œë‹¤. entityì— ê°’ì„ ì±„ì›Œ ë„£ëŠ”ë°, ëª¨ë“  ê°’ì´ ë³€ê²½ëœë‹¤.</li>
  <li>isNewëŠ” Persistable interfaceì˜ ë©”ì†Œë“œì´ë‹¤.</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nd">@Transactional</span>
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="o">&lt;</span><span class="no">S</span> <span class="kd">extends</span> <span class="no">T</span><span class="o">&gt;</span> <span class="no">S</span> <span class="nf">save</span><span class="o">(</span><span class="no">S</span> <span class="n">entity</span><span class="o">)</span> <span class="o">{</span>

		<span class="nc">Assert</span><span class="o">.</span><span class="na">notNull</span><span class="o">(</span><span class="n">entity</span><span class="o">,</span> <span class="s">"Entity must not be null."</span><span class="o">);</span>

		<span class="k">if</span> <span class="o">(</span><span class="n">entityInformation</span><span class="o">.</span><span class="na">isNew</span><span class="o">(</span><span class="n">entity</span><span class="o">))</span> <span class="o">{</span>
			<span class="n">em</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">entity</span><span class="o">);</span>
			<span class="k">return</span> <span class="n">entity</span><span class="o">;</span>
		<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
			<span class="k">return</span> <span class="n">em</span><span class="o">.</span><span class="na">merge</span><span class="o">(</span><span class="n">entity</span><span class="o">);</span>
		<span class="o">}</span>
	<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>persist ì™€ mergeì˜ ì„¤ëª…</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="cm">/**
     * Make an instance managed and persistent.
     * @param entity  entity instance
     * @throws EntityExistsException if the entity already exists.
     * (If the entity already exists, the &lt;code&gt;EntityExistsException&lt;/code&gt; may
     * be thrown when the persist operation is invoked, or the
     * &lt;code&gt;EntityExistsException&lt;/code&gt; or another &lt;code&gt;PersistenceException&lt;/code&gt; may be
     * thrown at flush or commit time.)
     * @throws IllegalArgumentException if the instance is not an
     *         entity
     * @throws TransactionRequiredException if there is no transaction when
     *         invoked on a container-managed entity manager of that is of type
     *         &lt;code&gt;PersistenceContextType.TRANSACTION&lt;/code&gt;
     */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">persist</span><span class="o">(</span><span class="nc">Object</span> <span class="n">entity</span><span class="o">);</span>

    <span class="cm">/**
     * Merge the state of the given entity into the
     * current persistence context.
     * @param entity  entity instance
     * @return the managed instance that the state was merged to
     * @throws IllegalArgumentException if instance is not an
     *         entity or is a removed entity
     * @throws TransactionRequiredException if there is no transaction when
     *         invoked on a container-managed entity manager of that is of type
     *         &lt;code&gt;PersistenceContextType.TRANSACTION&lt;/code&gt;
     */</span>
    <span class="kd">public</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="no">T</span> <span class="nf">merge</span><span class="o">(</span><span class="no">T</span> <span class="n">entity</span><span class="o">);</span>
</code></pre></div></div>

<ul>
  <li>Persistableì„ êµ¬í˜„í•˜ì§€ ì•Šìœ¼ë©´, ê¸°ë³¸ì ìœ¼ë¡œ AbstractEntityInformationì˜ isNewë¥¼ ì‹¤í–‰í•˜ê²Œ ëœë‹¤.</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isNew</span><span class="o">(</span><span class="no">T</span> <span class="n">entity</span><span class="o">)</span> <span class="o">{</span>

		<span class="no">ID</span> <span class="n">id</span> <span class="o">=</span> <span class="n">getId</span><span class="o">(</span><span class="n">entity</span><span class="o">);</span>
		<span class="nc">Class</span><span class="o">&lt;</span><span class="no">ID</span><span class="o">&gt;</span> <span class="n">idType</span> <span class="o">=</span> <span class="n">getIdType</span><span class="o">();</span>

		<span class="k">if</span> <span class="o">(!</span><span class="n">idType</span><span class="o">.</span><span class="na">isPrimitive</span><span class="o">())</span> <span class="o">{</span>
			<span class="k">return</span> <span class="n">id</span> <span class="o">==</span> <span class="kc">null</span><span class="o">;</span>
		<span class="o">}</span>

		<span class="k">if</span> <span class="o">(</span><span class="n">id</span> <span class="k">instanceof</span> <span class="nc">Number</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">return</span> <span class="o">((</span><span class="nc">Number</span><span class="o">)</span> <span class="n">id</span><span class="o">).</span><span class="na">longValue</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0L</span><span class="o">;</span>
		<span class="o">}</span>

		<span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalArgumentException</span><span class="o">(</span><span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"Unsupported primitive id type %s"</span><span class="o">,</span> <span class="n">idType</span><span class="o">));</span>
	<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>idë¥¼ ê°€ì ¸ì™€ì„œ, wrapper Typeì´ê³ , idê°€ nullì´ë©´ isNewë¼ê³  íŒë‹¨í•œë‹¤.</li>
  <li>
    <p>primitive Number ì´ê³ , 0 ì´ë©´ isNewë¼ê³  íŒë‹¨í•œë‹¤.</p>
  </li>
  <li>ê·¸ë ‡ê¸° ë•Œë¬¸ì—, isNewë¥¼ overrideí•˜ì§€ ì•Šì•˜ë‹¤ë©´, idê°€ ì—†ì„ë•Œ isNewë¼ê³  íŒë‹¨í•˜ê³ , persistë¥¼ í˜¸ì¶œí•œë‹¤.</li>
  <li>ë°˜ëŒ€ë¡œ Idê°€ ì¡´ì¬í•  ê²½ìš° saveí–ˆì„ë•Œ, isNewê°€ falseê°€ ë˜ê³  ,mergeë¥¼ í˜¸ì¶œí•œë‹¤.<br />
<br /></li>
  <li>ìì£¼ ìˆëŠ” ìƒí™©ì€ ì•„ë‹ˆì§€ë§Œ, ì¤€ì˜ì† ìƒíƒœì˜ ì—”í‹°í‹°ì˜ í•„ë“œë¥¼ ë³€ê²½í•˜ê³  saveë¥¼ í•˜ê²Œë˜ë©´, mergeê°€ í˜¸ì¶œëœë‹¤.</li>
  <li>ì´ë•Œ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ì—†ëŠ” ì—”í‹°í‹° ì´ë¯€ë¡œ, id ê¸°ì¤€ìœ¼ë¡œ dbì—ì„œ ì¡°íšŒí•´ì„œ, ì¤€ì˜ì†ìƒíƒœì˜ ì—”í‹°í‹°ë¥¼ ì¡°íšŒí•œ ì—”í‹°í‹°ì— ë®ì–´ì”Œì›Œë²„ë¦°ë‹¤.</li>
</ul>

<h3 id="ë³µí•©í‚¤ì™€-isnew">ë³µí•©í‚¤ì™€ isNew</h3>

<ul>
  <li>ë³µí•©í‚¤ë¥¼ ì‚¬ìš©í•˜ê²Œ ë˜ë©´, í‚¤ ìƒì„± ì „ëµ(auto_increment, using sequence ë“±ë“±)ì„ ì‚¬ìš©í• ìˆ˜ ì—†ë‹¤.</li>
  <li>ê·¸ë ‡ê¸° ë•Œë¬¸ì—, ë¡œì§ì—ì„œ ë³µí•©í‚¤ë¥¼ set í•´ì£¼ê²Œë˜ê³ , SimpleJpaRepositoryì˜ isNew ë™ì‘ì—ì„œ IDê°€ nullì´ ì•„ë‹ˆê¸° ë•Œë¬¸ì—, mergeë¥¼ ì§„í–‰í•œë‹¤.</li>
  <li>merge ì§„í–‰ìˆœì„œ : ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ìˆëŠ”ì§€ í™•ì¸ -&gt; ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ì—†ìœ¼ë©´ select í›„ merge, íŠ¸ëœì­ì…˜ ì¢…ë£Œì „ insert</li>
  <li>ì¦‰, select -&gt; insertê°€ ë°œìƒí•˜ê³ . í•„ìš”ì—†ëŠ” select ê°€ ë°œìƒí•œë‹¤â€¦</li>
  <li>ê²°ë¡  : system key(auto_increment) ì‹œìŠ¤í…œ í‚¤ë¥¼ ì‚¬ìš©í•˜ì.</li>
</ul>
:ET